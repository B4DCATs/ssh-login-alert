# SSH Alert - Secure SSH Connection Monitoring

–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è SSH-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ —Å–µ—Ä–≤–µ—Ä—É —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: IP-–∞–¥—Ä–µ—Å, fingerprint –∫–ª—é—á–∞, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª—é—á–∞, —Ç–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **–ì–∏–±–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤—ã—Ö –∏ —Ç–∏—Ö–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏—è—Ö
- **Retry –ª–æ–≥–∏–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ —Å–±–æ—è—Ö —Å–µ—Ç–∏ –∏–ª–∏ Telegram API
- **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π SSH-–∫–ª–∏–µ–Ω—Ç–æ–≤

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Linux —Å–µ—Ä–≤–µ—Ä —Å OpenSSH
- Python 3.6+
- curl
- bash 4.0+
- –ü—Ä–∞–≤–∞ root –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd ssh-alert

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo ./install.sh
```

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã**:
   ```bash
   sudo mkdir -p /opt/ssh-alert
   sudo cp ssh-alert-enhanced.sh /opt/ssh-alert/
   sudo cp key-parser.py /opt/ssh-alert/
   sudo cp config.conf /etc/ssh-alert/
   sudo chmod +x /opt/ssh-alert/*.sh
   sudo chmod +x /opt/ssh-alert/*.py
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH**:
   ```bash
   sudo cp /etc/ssh/sshrc /etc/ssh/sshrc.backup
   sudo tee /etc/ssh/sshrc > /dev/null << 'EOF'
   #!/bin/bash
   /opt/ssh-alert/ssh-alert-enhanced.sh &
   EOF
   sudo chmod +x /etc/ssh/sshrc
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
   ```bash
   sudo nano /etc/ssh-alert/config.conf
   ```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/ssh-alert/config.conf`:

```bash
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN="your_bot_token_here"
TELEGRAM_CHAT_ID="your_chat_id_here"

# Server Information
SERVER_NAME="server01"
SERVER_DOMAIN="example.com"

# Notification Settings
NOTIFY_INTERACTIVE_SESSIONS=true
NOTIFY_TUNNELS=false
NOTIFY_COMMANDS=false
DISABLE_NOTIFICATION_SOUND_FOR_TUNNELS=true

# Rate Limiting (seconds)
RATE_LIMIT_PER_IP=300
RATE_LIMIT_PER_KEY=60
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ authorized_keys

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `authorized_keys`:

```bash
sudo ./setup-authorized-keys.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤—å—Ç–µ `SSH_USER` –≤ –∫–ª—é—á–∏:

```
environment="SSH_USER=alice@example.com" ssh-rsa AAAAB3NzaC1yc2E... alice@laptop
```

## üì± –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞**:
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot` –±–æ—Ç—É [@BotFather](https://t.me/BotFather)
   - –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

2. **–ü–æ–ª—É—á–∏—Ç–µ Chat ID**:
   - –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ —á–∞—Ç –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
   - –ù–∞–π–¥–∏—Ç–µ `chat.id` –≤ –æ—Ç–≤–µ—Ç–µ

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo tail -f /var/log/ssh-alert.log

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo /opt/ssh-alert/ssh-alert-enhanced.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–π
sudo ./setup-authorized-keys.sh

# –£–¥–∞–ª–µ–Ω–∏–µ
sudo /opt/ssh-alert/uninstall.sh
```

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

SSH Alert —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:

- **Interactive shell** - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –∑–≤—É–∫–æ–º)
- **Tunnel** - SSH —Ç—É–Ω–Ω–µ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ –∑–≤—É–∫–∞)
- **Command execution** - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### –ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```
üîê SSH Login Alert:
User: root
Person: alice@example.com
Host: server01.example.com
IP: 103.75.127.215
Type: Interactive shell
Key: a1:b2:c3:d4:e5:f6...
Time: 2024-01-15 14:30:25 UTC
```

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**:
   ```bash
   sudo chmod 600 /etc/ssh-alert/config.conf
   sudo chown root:root /etc/ssh-alert/config.conf
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª**:
   ```bash
   # –†–∞–∑—Ä–µ—à–∏—Ç–µ SSH —Ç–æ–ª—å–∫–æ —Å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP
   sudo ufw allow from 192.168.1.0/24 to any port 22
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π**:
   ```bash
   sudo nano /etc/ssh/sshd_config
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: PasswordAuthentication no
   sudo systemctl restart sshd
   ```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

SSH Alert –≤–µ–¥—ë—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo tail -f /var/log/ssh-alert.log

# JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ JSON_LOGGING=true –≤ config.conf
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç**:
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ chat_id
   sudo grep -E "TELEGRAM_BOT_TOKEN|TELEGRAM_CHAT_ID" /etc/ssh-alert/config.conf
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
   sudo tail -f /var/log/ssh-alert.log
   ```

2. **–°–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**:
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
   ls -la /opt/ssh-alert/ssh-alert-enhanced.sh
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
   bash -n /opt/ssh-alert/ssh-alert-enhanced.sh
   ```

3. **Python –æ—à–∏–±–∫–∏**:
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Python
   python3 --version
   
   # –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä—Å–µ—Ä
   python3 /opt/ssh-alert/key-parser.py get-info
   ```

### –û—Ç–ª–∞–¥–∫–∞

–í–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏:

```bash
sudo nano /etc/ssh-alert/config.conf
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: LOG_LEVEL="DEBUG"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
sudo systemctl status ssh-alert 2>/dev/null || echo "Service not installed"

# –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo ss -tnp | grep sshd

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
sudo grep "SSH alert sent" /var/log/ssh-alert.log | tail -5
```

### –ú–µ—Ç—Ä–∏–∫–∏

SSH Alert –º–æ–∂–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ JSON –ª–æ–≥–∏:

```bash
# –í–∫–ª—é—á–∏—Ç–µ JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
echo 'JSON_LOGGING=true' | sudo tee -a /etc/ssh-alert/config.conf

# –ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤
sudo tail -f /var/log/ssh-alert.log | jq '.'
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
sudo cp -r /opt/ssh-alert /opt/ssh-alert.backup
sudo cp /etc/ssh-alert/config.conf /etc/ssh-alert/config.conf.backup

# –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã
sudo cp ssh-alert-enhanced.sh /opt/ssh-alert/
sudo cp key-parser.py /opt/ssh-alert/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
sudo systemctl restart ssh-alert
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`git checkout -b feature/amazing-feature`)
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [—Ä–∞–∑–¥–µ–ª —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
2. –°–æ–∑–¥–∞–π—Ç–µ [Issue](https://github.com/your-repo/ssh-alert/issues)
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ (Slack, Discord)
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIEM —Å–∏—Å—Ç–µ–º–∞–º–∏
- [ ] –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ IPv6
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
