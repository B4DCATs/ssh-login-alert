# SSH Alert Log Rotation Configuration
# ====================================
# This file configures automatic log rotation for SSH Alert

/var/log/ssh-alert.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress old logs
    compress
    
    # Delay compression by one day
    delaycompress
    
    # Don't rotate if log is empty
    notifempty
    
    # Create new log file with proper permissions
    create 644 root root
    
    # Don't rotate if log file is missing
    missingok
    
    # Copy and truncate instead of move (safer for running processes)
    copytruncate
    
    # Don't compress if log is smaller than 100KB
    minsize 100k
    
    # Maximum size before forcing rotation (10MB)
    maxsize 10M
    
    # Post-rotation script to reload any services if needed
    postrotate
        # No need to reload SSH Alert as it uses copytruncate
        # But we can add any cleanup here if needed
        true
    endscript
}

# Rate limiting directory cleanup
/tmp/ssh-alert-rate-limit/* {
    # Clean up old rate limiting files daily
    daily
    
    # Keep files for 7 days
    rotate 7
    
    # Don't compress (these are small files)
    nocompress
    
    # Don't rotate if directory is empty
    notifempty
    
    # Don't create new files
    nocreate
    
    # Don't rotate if missing
    missingok
    
    # Remove old files
    olddir /tmp/ssh-alert-rate-limit/old
    
    # Post-rotation cleanup
    postrotate
        # Remove old directory if empty
        rmdir /tmp/ssh-alert-rate-limit/old 2>/dev/null || true
    endscript
}
